<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Management - Register Game</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/styles.css}"/>
</head>
<body>
<div class="container-fluid">
  <div class="main-container">
    <!-- Header Section -->
    <div class="header-section">
      <div class="header-content">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h1 class="mb-2" th:text="${mode == 'edit' ? 'Edit Game' : 'Register New Game'}">
              <i class="fas fa-plus-circle me-3"></i>
            </h1>
            <p class="mb-0 opacity-90" th:text="${mode == 'edit' ? 'Edit your game in your collection' : 'Add a new game to your collection'}"></p>
          </div>
          <div>
            <a href="/api/games" class="btn btn-light btn-lg">
              <i class="fas fa-arrow-left me-2"></i>Back to List
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Container -->
    <form id="gameRegistrationForm" method="POST" th:action="@{${formAction}}" th:object="${inputGameRequest}" novalidate>
      <div class="form-container">
        <!-- Hidden fields for edit mode -->
        <div th:if="${mode == 'edit'}">
          <input type="hidden" th:field="*{updateAt}" />
        </div>

        <!-- Basic Information Section -->
        <div class="form-section">
          <h3>
            <i class="fas fa-info-circle text-primary"></i>
            Basic Information
          </h3>

          <div class="row">
            <div class="col-md-6">
              <label for="gameCode" class="form-label required-field">
                <i class="fas fa-code"></i>Game Code
              </label>
              <input type="text"
                     class="form-control"
                     id="gameCode"
                     name="gameCode"
                     th:field="*{gameCode}"
                     placeholder="e.g. UNCHARTED4"
                     required
                     minlength="5">
              <div class="help-text">Minimum 5 characters, unique identifier for the game</div>
              <div class="invalid-feedback" id="gameCodeError"></div>
            </div>

            <div class="col-md-6">
              <label for="category" class="form-label required-field">
                <i class="fas fa-tags"></i>Category
              </label>
              <select class="form-select"
                      id="category"
                      name="categoryRequest.categoryId"
                      th:field="*{categoryRequest.categoryId}"
                      required>
                <option value="">Select a category</option>
                <option th:each="cat : ${categories}"
                        th:value="${cat.categoryId}"
                        th:text="${cat.categoryName}"
                        th:selected="${cat.categoryId == inputGameRequest?.categoryRequest?.categoryId}">
                </option>
              </select>
              <div class="invalid-feedback" id="categoryError"></div>
            </div>
          </div>
        </div>

        <!-- Multilingual Names Section -->
        <div class="form-section">
          <h3>
            <i class="fas fa-globe text-primary"></i>
            Game Names (Multilingual)
          </h3>

          <div id="languageEntries">
            <!-- Language entries will be dynamically added here by JavaScript -->
          </div>

          <!-- Add Language Button -->
          <div class="add-language-btn" onclick="showAddLanguageModal()">
            <i class="fas fa-plus fa-2x text-muted mb-2"></i>
            <h5 class="text-muted mb-1">Add Language</h5>
            <p class="text-muted mb-0 small">Click to add a game name in another language</p>
          </div>

          <div class="help-text mt-2">
            <i class="fas fa-info-circle"></i>
            At least one language is required. You can set one language as default.
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <div>
          <a href="/api/games" class="btn btn-outline-primary">
            <i class="fas fa-times me-2"></i>Cancel
          </a>
        </div>
        <div class="d-flex gap-2">
          <button type="button" class="btn btn-secondary" onclick="resetForm()">
            <i class="fas fa-redo me-2"></i>Reset Form
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-2"></i>
            <span th:text="${mode == 'edit' ? 'Update Game' : 'Register Game'}">Register Game</span>
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Add Language Modal -->
<div class="modal fade" id="addLanguageModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-plus-circle me-2"></i>Add Language
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="modalLanguage" class="form-label">
            <i class="fas fa-language"></i>Language
          </label>
          <select class="form-select" id="modalLanguage">
            <option value="">Select a language</option>
            <!-- Will be populated dynamically -->
          </select>
        </div>
        <div class="mb-3">
          <label for="modalGameName" class="form-label">
            <i class="fas fa-gamepad"></i>Game Name
          </label>
          <input type="text" class="form-control" id="modalGameName" placeholder="Enter game name">
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="modalIsDefault">
          <label class="form-check-label" for="modalIsDefault">
            Set as default language
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="addLanguageEntry()">
          <i class="fas fa-plus me-2"></i>Add Language
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Toast Messages -->
<div class="toast-container">
  <!-- Success Toast -->
  <div th:if="${toastSuccessMessage}" class="toast align-items-center text-white bg-success border-0 show" role="alert">
    <div class="d-flex">
      <div class="toast-body">
        <i class="fas fa-check-circle me-2"></i>
        <span th:text="${toastSuccessMessage}"></span>
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>

  <!-- Error Toast -->
  <div th:if="${toastErrorMessage}" class="toast align-items-center text-white bg-danger border-0 show" role="alert">
    <div class="d-flex">
      <div class="toast-body">
        <i class="fas fa-exclamation-circle me-2"></i>
        <span th:text="${toastErrorMessage}"></span>
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>

  <!-- Validation Error Toast -->
  <div th:if="${validationErrorMessage}" class="toast align-items-center text-white bg-warning border-0 show" role="alert">
    <div class="d-flex">
      <div class="toast-body">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <span th:text="${validationErrorMessage}"></span>
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

<script th:inline="javascript">
  // Pass server data to JavaScript
  window.serverData = {
    languages: /*[[${languages}]]*/ [],
    inputGameRequest: /*[[${inputGameRequest}]]*/ null,
    mode: /*[[${mode}]]*/ 'register'
  };
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/register_game_form.js}"></script>

</body>
</html>